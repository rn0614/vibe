# React Hooks ê°œë°œ ê°€ì´ë“œ

> Router ì»¨í…ìŠ¤íŠ¸ì™€ ìƒíƒœ ê´€ë¦¬ì˜ ì˜¬ë°”ë¥¸ ë¶„ë¦¬ íŒ¨í„´

## ğŸ¯ í•µì‹¬ ì›ì¹™

### 1. Router ì»¨í…ìŠ¤íŠ¸ ë¶„ë¦¬ ì›ì¹™

#### âŒ í”¼í•´ì•¼ í•  íŒ¨í„´
```typescript
// useNavigateë¥¼ Core Hookì—ì„œ ì‚¬ìš© (ìœ„í—˜!)
export const useAuth = () => {
  const navigate = useNavigate(); // Router ì»¨í…ìŠ¤íŠ¸ ì˜ì¡´
  
  const signOut = useMutation({
    onSuccess: () => navigate('/') // Router ë°–ì—ì„œ í˜¸ì¶œ ì‹œ ì—ëŸ¬
  });
};
```

#### âœ… ì˜¬ë°”ë¥¸ íŒ¨í„´
```typescript
// Core Hook - Router ë…ë¦½ì 
export const useAuth = () => {
  const signOut = useMutation({
    mutationFn: () => authApi.signOut()
    // navigation ë¡œì§ ì—†ìŒ
  });
  
  return {
    signOut: signOut.mutate,
    signOutAsync: signOut.mutateAsync // await ê°€ëŠ¥
  };
};

// Action Hook - Router ì˜ì¡´ì 
export const useAuthActions = () => {
  const navigate = useNavigate();
  const auth = useAuth();
  
  const signOutWithRedirect = async (redirectTo = '/') => {
    await auth.signOutAsync();
    navigate(redirectTo, { replace: true });
  };
  
  return { ...auth, signOutWithRedirect };
};
```

### 2. Hook ë ˆì´ì–´ êµ¬ì¡°

```
ğŸ”¥ Core Hooks (Router ë…ë¦½ì )
â”œâ”€â”€ useAuth          # ìˆœìˆ˜ ì¸ì¦ ìƒíƒœ + ì•¡ì…˜
â”œâ”€â”€ useAppStore      # í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ
â”œâ”€â”€ useApi           # ì¼ë°˜ì ì¸ API í˜¸ì¶œ
â””â”€â”€ useSupabaseQuery # Supabase ë°ì´í„° í˜ì¹­

ğŸ”¥ Action Hooks (Router ì˜ì¡´ì )
â”œâ”€â”€ useAuthActions   # navigation í¬í•¨ ì¸ì¦ ì•¡ì…˜
â”œâ”€â”€ useFormActions   # í¼ ì œì¶œ + ë¦¬ë‹¤ì´ë ‰íŠ¸
â””â”€â”€ usePageActions   # í˜ì´ì§€ ì „í™˜ ë¡œì§
```

## ğŸ“‹ ê°œë°œ ê°€ì´ë“œë¼ì¸

### Hook ìƒì„± ì‹œ ê²°ì • ì‚¬í•­

#### 1. Router ì»¨í…ìŠ¤íŠ¸ í•„ìš” ì—¬ë¶€
```typescript
// âœ… Router ë…ë¦½ì  Hook
export const useData = () => {
  const query = useQuery(['data'], fetchData);
  const mutation = useMutation(updateData);
  
  return {
    data: query.data,
    updateData: mutation.mutate,
    updateDataAsync: mutation.mutateAsync
  };
};

// âœ… Router ì˜ì¡´ì  Action Hook  
export const useDataActions = () => {
  const navigate = useNavigate();
  const data = useData();
  
  const updateWithRedirect = async (newData, redirectTo) => {
    await data.updateDataAsync(newData);
    navigate(redirectTo);
  };
  
  return { ...data, updateWithRedirect };
};
```

#### 2. ìƒíƒœ ê´€ë¦¬ ë„êµ¬ ì„ íƒ
```typescript
// TanStack Query: ì„œë²„ ìƒíƒœ
const { user, posts } = useQuery(['posts'], fetchPosts);

// Zustand: í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ
const { theme, sidebarOpen } = useAppStore();

// React State: ì»´í¬ë„ŒíŠ¸ ë¡œì»¬ ìƒíƒœ
const [email, setEmail] = useState('');
```

### ì»´í¬ë„ŒíŠ¸ë³„ Hook ì‚¬ìš©ë²•

#### AuthInitializer (Router ë°–)
```typescript
export const AuthInitializer = ({ children }) => {
  useAuth(); // âœ… Core Hookë§Œ ì‚¬ìš©
  return <>{children}</>;
};
```

#### Header/Navigation (Router ì•ˆ)
```typescript
export const Header = () => {
  const { user, signOutWithRedirect } = useAuthActions(); // âœ… Action Hook
  
  return (
    <button onClick={() => signOutWithRedirect('/')}>
      ë¡œê·¸ì•„ì›ƒ
    </button>
  );
};
```

#### Data Display ì»´í¬ë„ŒíŠ¸
```typescript
export const UserProfile = () => {
  const { user, isLoading } = useAuth(); // âœ… Core Hook (ìƒíƒœë§Œ í•„ìš”)
  
  if (isLoading) return <Spinner />;
  return <div>{user?.name}</div>;
};
```

## ğŸ”„ TanStack Query íŒ¨í„´

### 1. ê¸°ë³¸ Query íŒ¨í„´
```typescript
export const usePosts = (categoryId?: string) => {
  return useQuery({
    queryKey: ['posts', categoryId],
    queryFn: () => fetchPosts(categoryId),
    staleTime: 5 * 60 * 1000, // 5ë¶„
    gcTime: 10 * 60 * 1000,   // 10ë¶„
    enabled: !!categoryId,     // ì¡°ê±´ë¶€ ì‹¤í–‰
  });
};
```

### 2. Mutation íŒ¨í„´
```typescript
export const useCreatePost = () => {
  const queryClient = useQueryClient();
  
  return useMutation({
    mutationFn: (data: CreatePostData) => postsApi.create(data),
    onSuccess: (newPost) => {
      // ê´€ë ¨ ì¿¼ë¦¬ ë¬´íš¨í™”
      queryClient.invalidateQueries(['posts']);
      queryClient.invalidateQueries(['posts', newPost.categoryId]);
      
      // ë˜ëŠ” Optimistic Update
      queryClient.setQueryData(['posts'], (oldData) => 
        oldData ? [...oldData, newPost] : [newPost]
      );
    },
    onError: (error) => {
      console.error('í¬ìŠ¤íŠ¸ ìƒì„± ì‹¤íŒ¨:', error);
    }
  });
};
```

### 3. ë¬´í•œ ìŠ¤í¬ë¡¤ íŒ¨í„´
```typescript
export const useInfinitePosts = () => {
  return useInfiniteQuery({
    queryKey: ['posts', 'infinite'],
    queryFn: ({ pageParam = 1 }) => fetchPosts({ page: pageParam }),
    getNextPageParam: (lastPage, pages) => 
      lastPage.hasMore ? pages.length + 1 : undefined,
    initialPageParam: 1,
  });
};
```

## ğŸ›¡ï¸ ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´

### 1. ê¸€ë¡œë²Œ ì—ëŸ¬ ì²˜ë¦¬
```typescript
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      retry: (failureCount, error: any) => {
        if (error?.status === 401 || error?.status === 403) {
          return false; // ì¸ì¦ ì—ëŸ¬ëŠ” ì¬ì‹œë„ ì•ˆ í•¨
        }
        return failureCount < 2;
      },
      onError: (error: any) => {
        if (error?.status === 401) {
          // ì¸ì¦ ë§Œë£Œ ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ
          window.location.href = '/login';
        }
      }
    }
  }
});
```

### 2. ì»´í¬ë„ŒíŠ¸ ë ˆë²¨ ì—ëŸ¬ ì²˜ë¦¬
```typescript
export const PostList = () => {
  const { data: posts, isLoading, error } = usePosts();
  
  if (isLoading) return <Spinner />;
  if (error) return <ErrorMessage error={error} />;
  if (!posts?.length) return <EmptyState />;
  
  return <div>{posts.map(post => <PostItem key={post.id} post={post} />)}</div>;
};
```

## ğŸ¯ ì²´í¬ë¦¬ìŠ¤íŠ¸

### âœ… Hook ìƒì„± ì‹œ
- [ ] Router ì»¨í…ìŠ¤íŠ¸ ì˜ì¡´ì„± í™•ì¸
- [ ] ì ì ˆí•œ ë ˆì´ì–´ (Core vs Action) ì„ íƒ
- [ ] ìƒíƒœ ê´€ë¦¬ ë„êµ¬ ì ì ˆíˆ ì„ íƒ
- [ ] ì—ëŸ¬ ì²˜ë¦¬ í¬í•¨
- [ ] TypeScript íƒ€ì… ì •ì˜

### âœ… Hook ì‚¬ìš© ì‹œ
- [ ] Router ì»¨í…ìŠ¤íŠ¸ ë‚´ë¶€ì¸ì§€ í™•ì¸
- [ ] í•„ìš”í•œ ê¸°ëŠ¥ì— ë§ëŠ” Hook ì„ íƒ
- [ ] ë¡œë”©/ì—ëŸ¬ ìƒíƒœ ì ì ˆíˆ ì²˜ë¦¬
- [ ] ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€

### âœ… TanStack Query ì‚¬ìš© ì‹œ
- [ ] ì ì ˆí•œ queryKey ì„¤ì •
- [ ] staleTime/gcTime ì„¤ì •
- [ ] ê´€ë ¨ ì¿¼ë¦¬ ë¬´íš¨í™” ì²˜ë¦¬
- [ ] Optimistic Update ê³ ë ¤

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- [HOOKS_ARCHITECTURE_GUIDE.md](../docs/HOOKS_ARCHITECTURE_GUIDE.md)
- [AUTH_UNIFIED_ARCHITECTURE.md](../docs/AUTH_UNIFIED_ARCHITECTURE.md)
- [DEVELOPMENT_PATTERNS.md](../docs/DEVELOPMENT_PATTERNS.md)